[gd_scene load_steps=15 format=3 uid="uid://blrh806e5yssb"]

[ext_resource type="PackedScene" uid="uid://ksrtlxdhhtvb" path="res://assets/enemy/enemy_pillar/Enemy_Pillar.glb" id="2_n7fcf"]
[ext_resource type="Script" uid="uid://bdbn4rfa0b3c3" path="res://assets/enemy/enemy_pillar/enemy_pillar.gd" id="2_vdavr"]
[ext_resource type="Script" uid="uid://dhefwn5nr2dpi" path="res://assets/enemy/enemy_base/enemy_target.gd" id="2_xmv3r"]
[ext_resource type="PackedScene" uid="uid://dkp5y0u8pd54k" path="res://assets/common/health/health.tscn" id="3_04hg2"]
[ext_resource type="Script" uid="uid://c57rja73wx5tf" path="res://assets/enemy/enemy_pillar/pillar_idle.gd" id="3_5qy18"]
[ext_resource type="Script" uid="uid://da5q7hn5atihn" path="res://assets/enemy/enemy_pillar/pillar_follow.gd" id="4_5qy18"]
[ext_resource type="PackedScene" uid="uid://bpycvx6icpx8o" path="res://assets/common/enemy_health_bar/health_bar.tscn" id="4_aj476"]
[ext_resource type="Script" uid="uid://cwrysv1cwpwav" path="res://assets/enemy/enemy_pillar/pillar_attack.gd" id="4_n7fcf"]
[ext_resource type="Script" uid="uid://jgmelc3l8nm4" path="res://assets/enemy/enemy_pillar/ground_detection.gd" id="6_sicnd"]

[sub_resource type="CylinderShape3D" id="CylinderShape3D_5qy18"]
height = 6.0
radius = 0.47168

[sub_resource type="BoxShape3D" id="BoxShape3D_5qy18"]
size = Vector3(1, 6, 0.8)

[sub_resource type="BoxShape3D" id="BoxShape3D_sicnd"]
size = Vector3(0.985, 6.08594, 0.99622)

[sub_resource type="SphereShape3D" id="SphereShape3D_xmv3r"]
radius = 0.2

[sub_resource type="SphereShape3D" id="SphereShape3D_04hg2"]
radius = 0.2

[node name="EnemyPillar" type="AnimatableBody3D" node_paths=PackedStringArray("state_nodes")]
collision_layer = 4
collision_mask = 14
sync_to_physics = false
script = ExtResource("2_vdavr")
state_nodes = {
0: NodePath("PillarIdle"),
1: NodePath("PillarFollow"),
3: NodePath("PillarAttack")
}

[node name="MeshOrigin" type="Node3D" parent="."]

[node name="Enemy_Pillar" parent="MeshOrigin" instance=ExtResource("2_n7fcf")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0)

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0)
shape = SubResource("CylinderShape3D_5qy18")

[node name="EnemyTarget" type="Node" parent="."]
script = ExtResource("2_xmv3r")

[node name="Health" parent="." instance=ExtResource("3_04hg2")]
max_health = 250
regen = 1.0

[node name="HealthBar" parent="." node_paths=PackedStringArray("health") instance=ExtResource("4_aj476")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0.40316)
health = NodePath("../Health")
size = Vector2(160, 20)

[node name="PillarIdle" type="Node3D" parent="." node_paths=PackedStringArray("controller", "target")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0)
script = ExtResource("3_5qy18")
controller = NodePath("..")
target = NodePath("../EnemyTarget")

[node name="PillarFollow" type="Node3D" parent="." node_paths=PackedStringArray("controller", "target")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0)
script = ExtResource("4_5qy18")
controller = NodePath("..")
target = NodePath("../EnemyTarget")

[node name="WaitTimer" type="Timer" parent="PillarFollow"]
wait_time = 0.15
one_shot = true

[node name="StatusEffects" type="Node" parent="."]

[node name="PillarAttack" type="Area3D" parent="." node_paths=PackedStringArray("controller", "target")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0)
collision_layer = 4
collision_mask = 6
monitoring = false
monitorable = false
script = ExtResource("4_n7fcf")
controller = NodePath("..")
target = NodePath("../EnemyTarget")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="PillarAttack"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.132092)
shape = SubResource("BoxShape3D_5qy18")

[node name="WaitTimer" type="Timer" parent="PillarAttack"]
wait_time = 2.0
one_shot = true

[node name="Timer" type="Timer" parent="PillarAttack"]
wait_time = 1.5
one_shot = true

[node name="GroundDetection" type="Area3D" parent="." node_paths=PackedStringArray("controller")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0)
collision_layer = 4
monitorable = false
script = ExtResource("6_sicnd")
controller = NodePath("..")

[node name="CollisionShape3D" type="CollisionShape3D" parent="GroundDetection"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.00292969, -0.0215185)
shape = SubResource("BoxShape3D_sicnd")

[node name="EndDetectionTop" type="Area3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 6, 0)
collision_layer = 0
monitoring = false
monitorable = false

[node name="CollisionShape3D" type="CollisionShape3D" parent="EndDetectionTop"]
shape = SubResource("SphereShape3D_xmv3r")

[node name="EndDetectionBottom" type="Area3D" parent="."]
transform = Transform3D(-1, 8.74228e-08, 0, -8.74228e-08, -1, 0, 0, 0, 1, 0, 0, 0)
collision_layer = 0
monitoring = false
monitorable = false

[node name="CollisionShape3D" type="CollisionShape3D" parent="EndDetectionBottom"]
shape = SubResource("SphereShape3D_04hg2")

[connection signal="died" from="Health" to="." method="_on_health_died"]
[connection signal="body_entered" from="PillarAttack" to="PillarAttack" method="_on_body_entered"]
